{
    "app-id": "com.sublimetext.three",
    "runtime": "org.gnome.Sdk",
    "runtime-version": "3.28",
    "sdk": "org.gnome.Sdk",
    "branch": "eos3",
    "command": "sublime",
    "separate-locales": false,
    "finish-args": [
        "--share=ipc", "--socket=x11",
        "--share=network",
        "--talk-name=org.gnome.SettingsDaemon",
        "--filesystem=home",
        "--filesystem=host:ro"
    ],
    "modules": [
        {
            "name": "python3-pycodestyle",
            "buildsystem": "simple",
            "build-commands": [
                "pip3.5 install --prefix=/app pycodestyle-2.3.1-py2.py3-none-any.whl"
            ],
            "sources": [
                {
                    "type": "file",
                    "url": "https://pypi.python.org/packages/e4/81/78fe51eb4038d1388b7217dd63770b0f428370207125047312886c923b26/pycodestyle-2.3.1-py2.py3-none-any.whl",
                    "sha256": "6c4245ade1edfad79c3446fadfc96b0de2759662dc29d07d80a6f27ad1ca6ba9"
                }
            ]
        },
        {
            "name": "python3-pyflakes",
            "buildsystem": "simple",
            "build-commands": [
                "pip3.5 install --prefix=/app pyflakes-1.5.0-py2.py3-none-any.whl"
            ],
            "sources": [
                {
                    "type": "file",
                    "url": "https://pypi.python.org/packages/27/49/924098b3b85c286696f37e014475d79471ffc44509613af420645a3c12cb/pyflakes-1.5.0-py2.py3-none-any.whl",
                    "sha256": "cc5eadfb38041f8366128786b4ca12700ed05bbf1403d808e89d57d67a3875a7"
                }
            ]
        },
        {
            "name": "python3-yamllint",
            "buildsystem": "simple",
            "build-commands": [
                "pip3.5 install --prefix=/app pathspec-0.5.5.tar.gz",
                "pip3.5 install --prefix=/app PyYAML-3.12.tar.gz",
                "pip3.5 install --prefix=/app yamllint-1.10.0-py2.py3-none-any.whl"
            ],
            "sources": [
                {
                    "type": "file",
                    "url": "https://pypi.python.org/packages/9f/fb/5a901a3b1eeebf83af6da74ecca69d7daf5189e450f0f4cccf9c19132651/pathspec-0.5.5.tar.gz",
                    "sha256": "72c495d1bbe76674219e307f6d1c6062f2e1b0b483a5e4886435127d0df3d0d3"
                },
                {
                    "type": "file",
                    "url": "https://pypi.python.org/packages/4a/85/db5a2df477072b2902b0eb892feb37d88ac635d36245a72a6a69b23b383a/PyYAML-3.12.tar.gz",
                    "sha256": "592766c6303207a20efc445587778322d7f73b161bd994f227adaa341ba212ab"
                },
                {
                    "type": "file",
                    "url": "https://pypi.python.org/packages/33/2d/3d4a3877163a7ac2edda327f3139694c47a97f8bfb37cadef93f895e352c/yamllint-1.10.0-py2.py3-none-any.whl",
                    "sha256": "c4f82ffea8a9941e42e41949ad0e2cbad8261e426197a29f03110b5823d77164"
                }
            ]
        },
        {
            "name": "nodejs",
            "cleanup": [
                "/include",
                "/share",
                "/app/lib/node_modules/npm/changelogs",
                "/app/lib/node_modules/npm/doc",
                "/app/lib/node_modules/npm/html",
                "/app/lib/node_modules/npm/man",
                "/app/lib/node_modules/npm/scripts"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://nodejs.org/dist/v8.9.2/node-v8.9.2.tar.gz",
                    "sha256": "8038fa61ac4562786fcc6d3229f3caa07a864b94bd5922fe75942a38ea1c3a3b"
                }
            ]
        },
        {
            "name": "js-packages",
            "buildsystem": "simple",
            "sources": [
                /* This file is autogenerated by:
                 * npm init
                 * npm install --save csslint eslint jshint
                 * flatpak-npm-generator.py package-lock.json */
                "generated-sources.json"
            ],
            "build-commands": [
                "npm install --prefix=dest --offline --cache=/run/build/hatch-previewer/npm-cache/",
                "mkdir -p /app/lib",
                "cp -ra dest/* /app/lib/"
            ]
        },
        {
            "name": "sublime",
            "buildsystem": "simple",
            "sources" : [
                {
                    "type": "script",
                    "dest-filename": "apply_extra",
                    "commands": [
                        "ar x sublime.deb",
                        "rm -f sublime.deb",
                        "tar xf data.tar.lzma",
                        "rm -f control.tar.gz data.tar.lzma debian-binary",
                        "mv usr/* .",
                        "rmdir usr",
                        "mkdir -p export/share/applications",
                        "sed s/Icon=sublime-text/Icon=com.sublimetext.three/ share/applications/sublime_text.desktop > export/share/applications/com.sublimetext.three.desktop",
                        "sed -i 's:Exec=/opt/sublime_text/sublime_text:Exec=sublime:' export/share/applications/com.sublimetext.three.desktop",
                        "mkdir -p export/share/icons/hicolor/256x256/apps",
                        "cp share/icons/hicolor/256x256/apps/sublime-text.png export/share/icons/hicolor/256x256/apps/com.sublimetext.three.png",
                        "sed -i 's:/opt/sublime_text/sublime_text:/app/extra/opt/sublime_text/sublime_text:' /app/extra/bin/subl"
                    ]
                },
                {
                    "type": "script",
                    "dest-filename": "sublime.sh",
                    "commands": [
                        "PCFILE=\"Package Control.sublime-package\"",
                        "PCLOCATION=\"$HOME/.var/app/com.sublimetext.three/config/sublime-text-3/Installed Packages\"",
                        "if ! test -f \"$PCLOCATION/$PCFILE\"; then",
                        "    cp \"/app/extra/$PCFILE\" \"$PCLOCATION\"",
                        "fi",
                        "exec /app/extra/bin/subl"
                    ]
                },
                {
                    "type": "extra-data",
                    "only-arches": ["x86_64"],
                    "filename": "sublime.deb",
                    "url": "https://download.sublimetext.com/files/sublime-text_build-3170_amd64.deb",
                    "sha256": "5eee39c4bd3f2c506d1b77de16547565dffa395e0a5fdb2c392692409138bb2f",
                    "size": 8490326
                },
                {
                    "type": "extra-data",
                    "only-arches": ["i386"],
                    "filename": "sublime.deb",
                    "url": "https://download.sublimetext.com/files/sublime-text_build-3170_i386.deb",
                    "sha256": "d7a56101912a1d580b03eeac7750baa99057da889b9f9e911ce3c717623732eb",
                    "size": 8591520
                },
                {
                    "type": "extra-data",
                    "filename": "Package Control.sublime-package",
                    "url": "http://packagecontrol.io/Package%20Control.sublime-package",
                    "sha256": "6f4c264a24d933ce70df5dedcf1dcaeeebe013ee18cced0ef93d5f746d80ef60",
                    "size": 286331
                }
            ],
            "build-commands": [
                "mkdir -p /app/bin",
                "mkdir -p /app/lib",
                "install apply_extra /app/bin",
                "install sublime.sh /app/bin/sublime",
                "cp /usr/bin/ar /app/bin",
                "cp /usr/lib/libbfd-*.so /app/lib"
            ],
            "post-install": [
                "mkdir -p /app/etc/xdg",
                "mkdir -p /app/share/applications"
            ]
        }
    ]
}
